{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "sidebar",
  "type": "registry:block",
  "title": "Sidebar",
  "author": "Tommy Lundy <tommerty@doras.to>",
  "description": "Advanced sidebar component that's collapsible, nestable, and built on store",
  "dependencies": [
    "@tanstack/react-store",
    "class-variance-authority",
    "@tabler/icons-react"
  ],
  "registryDependencies": [
    "button",
    "sheet",
    "tooltip",
    "popover"
  ],
  "files": [
    {
      "path": "registry/sidebar/sidebar.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { useStore } from \"@tanstack/react-store\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tSheet,\n\tSheetContent,\n\tSheetDescription,\n\tSheetHeader,\n\tSheetTitle,\n} from \"@/components/ui/sheet\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { sidebarStore, sidebarActions } from \"./sidebar-store\";\nimport { IconChevronRight, IconLayoutSidebar } from \"@tabler/icons-react\";\n\nconst SIDEBAR_WIDTH = \"16rem\";\nconst SIDEBAR_WIDTH_COLLAPSED = \"3.5rem\";\n\n// Context for sidebar ID\nconst SidebarContext = React.createContext<string | null>(null);\n\n// Hook to use sidebar\nexport function useSidebar(id?: string) {\n\tconst contextId = React.useContext(SidebarContext);\n\tconst sidebarId = id ?? contextId;\n\t\n\tif (!sidebarId) {\n\t\tthrow new Error(\"useSidebar must be called with an id or within a Sidebar component\");\n\t}\n\t\n\tconst sidebar = useStore(sidebarStore, (state) => state.sidebars[sidebarId]);\n\n\treturn {\n\t\tsidebar,\n\t\ttoggle: (isMobile = false) => sidebarActions.toggleSidebar(sidebarId, isMobile),\n\t\tsetOpen: (open: boolean, isMobile = false) =>\n\t\t\tsidebarActions.setOpen(sidebarId, open, isMobile),\n\t\tsetVariant: (variant: \"default\" | \"floating\") =>\n\t\t\tsidebarActions.setVariant(sidebarId, variant),\n\t};\n}\n\n// Sidebar Root\ninterface SidebarProps extends React.HTMLAttributes<HTMLDivElement> {\n\tid: string;\n\tside?: \"left\" | \"right\";\n\tvariant?: \"default\" | \"floating\";\n\tcollapsible?: boolean;\n\tdefaultOpen?: boolean;\n\twidth?: string;\n\tcollapsedWidth?: string;\n\tkeyboardShortcut?: string;\n}\n\nexport function Sidebar({\n\tid,\n\tside = \"left\",\n\tvariant = \"default\",\n\tcollapsible = true,\n\tdefaultOpen = true,\n\twidth = SIDEBAR_WIDTH,\n\tcollapsedWidth = SIDEBAR_WIDTH_COLLAPSED,\n\tkeyboardShortcut,\n\tclassName,\n\tchildren,\n\t...props\n}: SidebarProps) {\n\tconst [isMobile, setIsMobile] = React.useState(false);\n\tconst [isClient, setIsClient] = React.useState(false);\n\tconst hasRegistered = React.useRef(false);\n\t\n\t// Subscribe to store state - this will have the persisted value on client\n\tconst { sidebar } = useSidebar(id);\n\t\n\t// Mark when we're on the client\n\tReact.useEffect(() => {\n\t\tsetIsClient(true);\n\t}, []);\n\t\n\t// Register sidebar on mount\n\tReact.useEffect(() => {\n\t\tif (hasRegistered.current) return;\n\n\t\tconst normalizedShortcut =\n\t\t\tkeyboardShortcut && keyboardShortcut.length === 1\n\t\t\t\t? `mod+${keyboardShortcut}`\n\t\t\t\t: keyboardShortcut;\n\n\t\tconst existing = sidebarStore.state.sidebars[id];\n\t\tif (!existing) {\n\t\t\tsidebarActions.registerSidebar(id, {\n\t\t\t\topen: defaultOpen,\n\t\t\t\tvariant,\n\t\t\t\tside,\n\t\t\t\topenMobile: false,\n\t\t\t\tkeyboardShortcut: normalizedShortcut,\n\t\t\t});\n\t\t} else if (normalizedShortcut !== existing.keyboardShortcut) {\n\t\t\t// Update keyboard shortcut if changed\n\t\t\tsidebarActions.setKeyboardShortcut(id, normalizedShortcut);\n\t\t}\n\n\t\thasRegistered.current = true;\n\n\t\treturn () => {\n\t\t\thasRegistered.current = false;\n\t\t\tsidebarActions.unregisterSidebar(id);\n\t\t};\n\t}, [id, defaultOpen, variant, side, keyboardShortcut]);\n\n\t// Keyboard shortcut handler\n\tReact.useEffect(() => {\n\t\tif (!keyboardShortcut) return;\n\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\n\t\t\t// Only support mod+key for now\n\t\t\tif (!event.metaKey && !event.ctrlKey) return;\n\n\t\t\tconst key = keyboardShortcut.replace(/mod\\+/i, \"\").toLowerCase();\n\t\t\tif (event.key.toLowerCase() === key) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tsidebarActions.toggleSidebar(id);\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [id, keyboardShortcut]);\n\n\t// Update CSS variable when sidebar state changes\n\tReact.useEffect(() => {\n\t\tif (sidebar) {\n\t\t\tconst newWidth = sidebar.open ? width : collapsedWidth;\n\t\t\tdocument.documentElement.style.setProperty(`--sidebar-${id}-width`, newWidth);\n\t\t}\n\t}, [sidebar?.open, id, width, collapsedWidth]);\n\n\tReact.useEffect(() => {\n\t\tconst checkMobile = () => setIsMobile(window.innerWidth < 768);\n\t\tcheckMobile();\n\t\twindow.addEventListener(\"resize\", checkMobile);\n\t\treturn () => window.removeEventListener(\"resize\", checkMobile);\n\t}, []);\n\n\t// Use sidebar state if available, otherwise defaultOpen\n\tconst isOpen = sidebar ? (isMobile ? sidebar.openMobile : sidebar.open) : defaultOpen;\n\tconst currentWidth = isOpen ? width : collapsedWidth;\n\n\t// Mobile: show Sheet\n\tif (isMobile) {\n\t\treturn (\n\t\t\t<SidebarContext.Provider value={id}>\n\t\t\t\t<Sheet\n\t\t\t\t\topen={sidebar ? sidebar.openMobile : false}\n\t\t\t\t\tonOpenChange={(open) => sidebarActions.setOpen(id, open, true)}\n\t\t\t\t>\n\t\t\t\t\t<SheetContent side={side} className=\"w-[18rem] p-0\">\n\t\t\t\t\t\t<SheetHeader className=\"sr-only\">\n\t\t\t\t\t\t\t<SheetTitle>Navigation</SheetTitle>\n\t\t\t\t\t\t\t<SheetDescription>Mobile navigation menu</SheetDescription>\n\t\t\t\t\t\t</SheetHeader>\n\t\t\t\t\t\t<div className=\"flex h-full flex-col\">{children}</div>\n\t\t\t\t\t</SheetContent>\n\t\t\t\t</Sheet>\n\t\t\t</SidebarContext.Provider>\n\t\t);\n\t}\n\n\tconst baseStyles = \"sticky top-0 h-full overflow-hidden transition-all\";\n    \tconst variantRootStyles = {\n\t\tdefault: \"h-full\",\n\t\tfloating: \"m-3\",\n\t};\n\tconst variantStyles = {\n\t\tdefault: \"bg-sidebar\",\n\t\tfloating: \"bg-sidebar rounded-lg border\",\n\t};\n\n\t// Server: render skeleton with CSS variable only (no content)\n\t// This prevents hydration mismatch because server doesn't know localStorage state\n\tif (!isClient) {\n\t\treturn (\n            <div className={cn(variantRootStyles[variant])}>\n\t\t\t<aside\n\t\t\t\tdata-sidebar-id={id}\n\t\t\t\tdata-variant={variant}\n\t\t\t\tdata-side={side}\n\t\t\t\tstyle={{ \n\t\t\t\t\twidth: `var(--sidebar-${id}-width, ${defaultOpen ? width : collapsedWidth})`,\n\t\t\t\t\tminWidth: `var(--sidebar-${id}-width, ${defaultOpen ? width : collapsedWidth})`,\n\t\t\t\t\tmaxWidth: `var(--sidebar-${id}-width, ${defaultOpen ? width : collapsedWidth})`\n\t\t\t\t}}\n\t\t\t\tclassName={cn(baseStyles, variantStyles[variant], className, \"\")}\n\t\t\t\t{...props}\n\t\t\t>\n\t\t\t\t{/* Skeleton - no content on server */}\n\t\t\t\t<div className=\"flex h-full flex-col overflow-hidden\" style={{ width: `var(--sidebar-${id}-width, ${defaultOpen ? width : collapsedWidth})` }} >\n                   \n                </div>\n\t\t\t</aside>\n            </div>\n\t\t);\n\t}\n\n\t// Client: render full sidebar with content\n\treturn (\n\t\t<SidebarContext.Provider value={id}>\n\t\t\t<TooltipProvider delayDuration={0}>\n\t\t\t\t<div className={cn(variantRootStyles[variant])}>\n\t\t\t\t\t<aside\n\t\t\t\t\t\tdata-sidebar-id={id}\n\t\t\t\t\t\tdata-state={isOpen ? \"expanded\" : \"collapsed\"}\n\t\t\t\t\t\tdata-variant={variant}\n\t\t\t\t\t\tdata-side={side}\n\t\t\t\t\t\tstyle={{ \n\t\t\t\t\t\t\twidth: `var(--sidebar-${id}-width, ${currentWidth})`,\n\t\t\t\t\t\t\tminWidth: `var(--sidebar-${id}-width, ${currentWidth})`,\n\t\t\t\t\t\t\tmaxWidth: `var(--sidebar-${id}-width, ${currentWidth})`\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName={cn(baseStyles, variantStyles[variant], className)}\n\t\t\t\t\t\t{...props}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"flex h-full flex-col overflow-hidden\" style={{ width: `var(--sidebar-${id}-width, ${currentWidth})` }}>\n\t\t\t\t\t\t\t{children}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</aside>\n\t\t\t\t</div>\n\t\t\t</TooltipProvider>\n\t\t</SidebarContext.Provider>\n\t);\n}\n\n// Sidebar Header\nexport function SidebarHeader({\n\tclassName,\n\t...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\"flex flex-col gap-0.5 p-2\", className)}\n\t\t\t{...props}\n\t\t/>\n\t);\n}\n\n// Sidebar Content\nexport function SidebarContent({\n\tclassName,\n\t...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\"flex-1 overflow-y-auto overflow-x-hidden p-2\", className)}\n\t\t\t{...props}\n\t\t/>\n\t);\n}\n\n// Sidebar Footer\nexport function SidebarFooter({\n\tclassName,\n\t...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\"mt-auto border-t p-2\", className)}\n\t\t\t{...props}\n\t\t/>\n\t);\n}\n\n// Sidebar Group\nexport function SidebarGroup({\n\tclassName,\n\t...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n\treturn <div className={cn(\"flex flex-col gap-0.5\", className)} {...props} />;\n}\n\n// Sidebar Group Label\nexport function SidebarGroupLabel({\n\tclassName,\n\t...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"px-3 py-1.5 text-xs font-medium text-muted-foreground\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t\t{...props}\n\t\t/>\n\t);\n}\n\n// Sidebar Menu\nexport function SidebarMenu({\n\tclassName,\n\t...props\n}: React.HTMLAttributes<HTMLUListElement>) {\n\treturn <ul className={cn(\"flex flex-col 0.5\", className)} {...props} />;\n}\n\n// Sidebar Menu Item\ninterface SidebarMenuItemProps extends React.HTMLAttributes<HTMLLIElement> {\n    isActive?: boolean;\n    isCollapsed?: boolean;\n\tshowWhenCollapsed?: boolean;\n\thideWhenCollapsed?: boolean;\n}\n\nexport function SidebarMenuItem({\n\tclassName,\n    isActive,\n    isCollapsed,\n\tshowWhenCollapsed,\n\thideWhenCollapsed,\n\tchildren,\n\t...props\n}: SidebarMenuItemProps) {\n\tconst { sidebar } = useSidebar();\n\tconst collapsed = sidebar && !sidebar.open;\n\t\n\t// Hide when collapsed if hideWhenCollapsed is true\n\tif (hideWhenCollapsed && collapsed) return null;\n\t\n\t// Hide when expanded if showWhenCollapsed is true\n\tif (showWhenCollapsed && !collapsed) return null;\n\t\n\treturn <li className={cn(\"relative duration-150 flex w-full items-center gap-1 shrink-0 px-1\",\n        \"flex w-full items-center gap-3 transition-all justify-start text-left flex-1 group/item rounded-lg text-sm\",\n\n\t\t\t\t\"hover:bg-accent hover:text-accent-foreground\",\n\t\t\t\t\"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\",\n\t\t\t\tisActive && \"bg-accent font-medium text-accent-foreground\",\n                (isCollapsed || collapsed) && \"justify-center aspect-square\",\n                \n\t\t\t\t className)} data-active={isActive} {...props}>{children}</li>;\n}\n\n// Sidebar Menu Sub\nexport function SidebarMenuSub({\n\tclassName,\n\tchildren,\n\t...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n\tconst { sidebar } = useSidebar();\n\tconst isCollapsed = sidebar && !sidebar.open;\n\t\n\tif (isCollapsed) return null;\n\t\n\treturn <div className={cn(\"flex items-center gap-1 w-fit\", className)} {...props}>{children}</div>;\n}\n\n// Sidebar Menu Button\ninterface SidebarMenuButtonProps\n\textends React.ButtonHTMLAttributes<HTMLButtonElement> {\n\tisActive?: boolean;\n\ttooltip?: string;\n\tasChild?: boolean;\n\ticon?: React.ReactNode;\n    size?: \"default\" | \"large\";\n}\n\nexport function SidebarMenuButton({\n\tisActive,\n\ttooltip,\n\ticon,\n\tclassName,\n\tchildren,\n    size,\n\t...props\n}: SidebarMenuButtonProps) {\n\tconst { sidebar } = useSidebar();\n\tconst isCollapsed = sidebar && !sidebar.open;\n\n\tconst button = (\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tdata-active={isActive}\n\t\t\tclassName={cn(\n\t\t\t\t\"flex w-full items-center gap-3 text-inherit duration-150 transition-all justify-start text-left flex-1 rounded-lg p-2\",\n\t\t\t\t\"\",\n\t\t\t\t\"focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-transparent\",\n                size === \"large\" && \"font-semibold py-3\",\n\t\t\t\tisActive && \"bg-accent font-medium text-accent-foreground\",\n                isCollapsed && \"justify-center aspect-square\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t\t{...props}\n\t\t>\n\t\t\t{icon && <span className={cn(\"[&>svg]:size-4 [&>svg]:shrink-0\")}>{icon}</span>}\n            {children ? (\n                !isCollapsed && <span className=\"flex-1 truncate\">{children}</span>\n            ) : null\n            }\n\t\t</button>\n\t);\n\n\tif (isCollapsed && tooltip) {\n\t\treturn (\n\t\t\t<Tooltip>\n\t\t\t\t<TooltipTrigger asChild>{button}</TooltipTrigger>\n\t\t\t\t<TooltipContent side=\"right\">{tooltip}</TooltipContent>\n\t\t\t</Tooltip>\n\t\t);\n\t}\n\n\treturn button;\n}\n\n// Sidebar Submenu\ninterface SidebarSubmenuProps extends React.HTMLAttributes<HTMLDivElement> {\n\tlabel: string;\n\ticon?: React.ReactNode;\n\tdefaultOpen?: boolean;\n    forcePopup?: boolean;\n}\n\nexport function SidebarSubmenu({\n\tlabel,\n\ticon,\n\tdefaultOpen = false,\n\tclassName,\n\tchildren,\n    forcePopup = false,\n\t...props\n}: SidebarSubmenuProps) {\n\tconst [isOpen, setIsOpen] = React.useState(defaultOpen);\n\tconst { sidebar } = useSidebar();\n\tconst isCollapsed = sidebar && !sidebar.open;\n\n\tconst trigger = (\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tonClick={() => !isCollapsed && !forcePopup && setIsOpen(!isOpen)}\n\t\t\tclassName={cn(\n\t\t\t\t\"flex w-full min-w-full items-center gap-3 text-inherit duration-150 transition-all justify-start text-left flex-1 rounded-lg p-2\",\n\t\t\t\t\"hover:bg-accent hover:font-medium hover:text-accent-foreground\",\n\t\t\t\t\"focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-transparent\",\n                !isCollapsed && isOpen && \"bg-accent font-medium text-accent-foreground\"\n\t\t\t)}\n\t\t>\n\t\t\t{icon && <span className={cn(\"shrink-0\", \"[&>svg]:size-4\")}>{icon}</span>}\n\t\t\t{!isCollapsed && (\n\t\t\t\t<>\n\t\t\t\t\t<span className=\"flex-1 truncate text-left\">{label}</span>\n                    <IconChevronRight\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"transition-all size-4\",\n\t\t\t\t\t\tisOpen ? \"rotate-90 transition-all\" : \"\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</button>\n\t);\n\n\tif (forcePopup) {\n\t\treturn (\n\t\t\t<Popover open={isOpen} onOpenChange={setIsOpen}>\n                {isCollapsed ? (\n                    <Tooltip>\n\t\t\t\t<TooltipTrigger asChild><PopoverTrigger asChild>\n\t\t\t\t\t{trigger}\n\t\t\t\t</PopoverTrigger></TooltipTrigger>\n\t\t\t\t<TooltipContent side=\"right\">{label}</TooltipContent>\n\t\t\t</Tooltip>\n                ): (\n                    <PopoverTrigger asChild>\n\t\t\t\t\t{trigger}\n\t\t\t\t</PopoverTrigger>\n                )}\n                \n\t\t\t\t\n\t\t\t\t<PopoverContent side=\"right\" align=\"start\" className=\"w-48 p-0\">\n\t\t\t\t\t<div className=\"flex flex-col gap-0.5\">\n\t\t\t\t\t\t<div className=\"p-3 text-sm font-semibold border-b flex items-center gap-2\">{icon && <span className={cn(\"shrink-0\", \"[&>svg]:size-4\")}>{icon}</span>}{label}</div>\n                        <div className=\"flex flex-col gap-0.5 p-1\">\n\t\t\t\t\t\t{children}\n                        </div>\n\t\t\t\t\t</div>\n\t\t\t\t</PopoverContent>\n\t\t\t</Popover>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className={cn(\"w-full\",className)} {...props}>\n\t\t\t{trigger}\n\t\t\t{isOpen && (\n\t\t\t\t<div className=\"ml-3 mt-1 flex flex-col gap-0.5 border-l pl-3\">\n\t\t\t\t\t{children}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\n// Sidebar Submenu Item\nexport function SidebarSubmenuItem({\n\tisActive,\n\tclassName,\n\tchildren,\n\t...props\n}: React.ButtonHTMLAttributes<HTMLButtonElement> & { isActive?: boolean }) {\n\treturn (\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tdata-active={isActive}\n\t\t\tclassName={cn(\n\t\t\t\t\"flex w-full items-center gap-2 rounded-md px-3 py-1.5 text-sm transition-colors\",\n\t\t\t\t\"hover:bg-accent hover:text-accent-foreground\",\n\t\t\t\t\"focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-transparent\",\n\t\t\t\tisActive && \"bg-accent font-medium text-accent-foreground\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t\t{...props}\n\t\t>\n\t\t\t{children}\n\t\t</button>\n\t);\n}\n\n// Sidebar Trigger\nexport function SidebarTrigger({\n\tsidebarId: propSidebarId,\n\tclassName,\n\t...props\n}: React.ButtonHTMLAttributes<HTMLButtonElement> & { sidebarId?: string }) {\n\tconst contextSidebarId = React.useContext(SidebarContext);\n\tconst sidebarId = propSidebarId ?? contextSidebarId;\n\n\tif (!sidebarId) {\n\t\tthrow new Error(\n\t\t\t\"SidebarTrigger must be used within a Sidebar component or passed a sidebarId prop\",\n\t\t);\n\t}\n\n\tconst [isMobile, setIsMobile] = React.useState(false);\n\n\tReact.useEffect(() => {\n\t\tconst checkMobile = () => {\n\t\t\tsetIsMobile(window.innerWidth < 768);\n\t\t};\n\t\tcheckMobile();\n\t\twindow.addEventListener(\"resize\", checkMobile);\n\t\treturn () => window.removeEventListener(\"resize\", checkMobile);\n\t}, []);\n\n\treturn (\n\t\t<Button\n\t\t\tvariant=\"ghost\"\n\t\t\tsize=\"icon\"\n\t\t\tclassName={cn(\"\", className)}\n\t\t\tonClick={() => sidebarActions.toggleSidebar(sidebarId, isMobile)}\n\t\t\t{...props}\n\t\t>\n\t\t\t<IconLayoutSidebar className=\"h-4 w-4\" />\n\t\t\t<span className=\"sr-only\">Toggle Sidebar</span>\n\t\t</Button>\n\t);\n}",
      "type": "registry:component",
      "target": "components/doras-ui/sidebar.tsx"
    },
    {
      "path": "registry/sidebar/sidebar-store.ts",
      "content": "import { Store } from \"@tanstack/react-store\";\n\nexport interface SidebarState {\n\topen: boolean;\n\topenMobile: boolean;\n\tvariant: \"default\" | \"floating\" | \"inset\";\n\tside: \"left\" | \"right\";\n\tkeyboardShortcut?: string;\n}\n\nexport interface SidebarStoreState {\n\tsidebars: Record<string, SidebarState>;\n\tkeyboardShortcuts: Record<string, string>; // Map of shortcut -> sidebarId\n}\n\nconst STORAGE_KEY = \"sidebar-state\";\n\n// Load initial state from localStorage\nfunction loadPersistedState(): SidebarStoreState {\n\tif (typeof window === \"undefined\") {\n\t\treturn { sidebars: {}, keyboardShortcuts: {} };\n\t}\n\n\ttry {\n\t\tconst stored = localStorage.getItem(STORAGE_KEY);\n\t\tif (stored) {\n\t\t\tconst parsed = JSON.parse(stored);\n\t\t\t// Ensure keyboardShortcuts exists for backward compatibility\n\t\t\treturn {\n\t\t\t\tsidebars: parsed.sidebars || {},\n\t\t\t\tkeyboardShortcuts: parsed.keyboardShortcuts || {},\n\t\t\t};\n\t\t}\n\t} catch (error) {\n\t\tconsole.error(\"Failed to load sidebar state from localStorage:\", error);\n\t}\n\n\treturn { sidebars: {}, keyboardShortcuts: {} };\n}\n\n// Save state to localStorage\nfunction persistState(state: SidebarStoreState) {\n\tif (typeof window === \"undefined\") return;\n\n\ttry {\n\t\tlocalStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n\t} catch (error) {\n\t\tconsole.error(\"Failed to save sidebar state to localStorage:\", error);\n\t}\n}\n\nexport const sidebarStore = new Store<SidebarStoreState>(loadPersistedState());\n\n// Subscribe to store changes and persist to localStorage\nsidebarStore.subscribe(() => {\n\tpersistState(sidebarStore.state);\n});\n\nexport const sidebarActions = {\n\tregisterSidebar: (\n\t\tid: string,\n\t\tinitialState: Partial<SidebarState> = {},\n\t) => {\n\t\tsidebarStore.setState((state) => {\n\t\t\tconst newState: SidebarState = {\n\t\t\t\topen: true,\n\t\t\t\topenMobile: false,\n\t\t\t\tvariant: \"default\",\n\t\t\t\tside: \"left\",\n\t\t\t\t...initialState,\n\t\t\t};\n\n\t\t\t// Update keyboard shortcuts mapping if a shortcut is provided\n\t\t\tconst newKeyboardShortcuts = { ...state.keyboardShortcuts };\n\t\t\tif (newState.keyboardShortcut) {\n\t\t\t\tnewKeyboardShortcuts[newState.keyboardShortcut] = id;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tsidebars: {\n\t\t\t\t\t...state.sidebars,\n\t\t\t\t\t[id]: newState,\n\t\t\t\t},\n\t\t\t\tkeyboardShortcuts: newKeyboardShortcuts,\n\t\t\t};\n\t\t});\n\t},\n\n\tunregisterSidebar: (id: string) => {\n\t\tsidebarStore.setState((state) => {\n\t\t\tconst { [id]: removedSidebar, ...rest } = state.sidebars;\n\t\t\t\n\t\t\t// Remove keyboard shortcut mapping if exists\n\t\t\tconst newKeyboardShortcuts = { ...state.keyboardShortcuts };\n\t\t\tif (removedSidebar?.keyboardShortcut) {\n\t\t\t\tdelete newKeyboardShortcuts[removedSidebar.keyboardShortcut];\n\t\t\t}\n\n\t\t\treturn { \n\t\t\t\tsidebars: rest,\n\t\t\t\tkeyboardShortcuts: newKeyboardShortcuts,\n\t\t\t};\n\t\t});\n\t},\n\n\ttoggleSidebar: (id: string, isMobile = false) => {\n\t\tsidebarStore.setState((state) => {\n\t\t\tconst sidebar = state.sidebars[id];\n\t\t\tif (!sidebar) return state;\n\n\t\t\treturn {\n\t\t\t\tsidebars: {\n\t\t\t\t\t...state.sidebars,\n\t\t\t\t\t[id]: {\n\t\t\t\t\t\t...sidebar,\n\t\t\t\t\t\t...(isMobile\n\t\t\t\t\t\t\t? { openMobile: !sidebar.openMobile }\n\t\t\t\t\t\t\t: { open: !sidebar.open }),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tkeyboardShortcuts: state.keyboardShortcuts,\n\t\t\t};\n\t\t});\n\t},\n\n\tsetOpen: (id: string, open: boolean, isMobile = false) => {\n\t\tsidebarStore.setState((state) => {\n\t\t\tconst sidebar = state.sidebars[id];\n\t\t\tif (!sidebar) return state;\n\n\t\t\treturn {\n\t\t\t\tsidebars: {\n\t\t\t\t\t...state.sidebars,\n\t\t\t\t\t[id]: {\n\t\t\t\t\t\t...sidebar,\n\t\t\t\t\t\t...(isMobile ? { openMobile: open } : { open }),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tkeyboardShortcuts: state.keyboardShortcuts,\n\t\t\t};\n\t\t});\n\t},\n\n\tsetVariant: (id: string, variant: SidebarState[\"variant\"]) => {\n\t\tsidebarStore.setState((state) => {\n\t\t\tconst sidebar = state.sidebars[id];\n\t\t\tif (!sidebar) return state;\n\n\t\t\treturn {\n\t\t\t\tsidebars: {\n\t\t\t\t\t...state.sidebars,\n\t\t\t\t\t[id]: { ...sidebar, variant },\n\t\t\t\t},\n\t\t\t\tkeyboardShortcuts: state.keyboardShortcuts,\n\t\t\t};\n\t\t});\n\t},\n\n\tsetKeyboardShortcut: (id: string, shortcut: string | undefined) => {\n\t\tsidebarStore.setState((state) => {\n\t\t\tconst sidebar = state.sidebars[id];\n\t\t\tif (!sidebar) return state;\n\n\t\t\t// Remove old shortcut mapping if exists\n\t\t\tconst newKeyboardShortcuts = { ...state.keyboardShortcuts };\n\t\t\tif (sidebar.keyboardShortcut) {\n\t\t\t\tdelete newKeyboardShortcuts[sidebar.keyboardShortcut];\n\t\t\t}\n\n\t\t\t// Add new shortcut mapping if provided\n\t\t\tif (shortcut) {\n\t\t\t\tnewKeyboardShortcuts[shortcut] = id;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tsidebars: {\n\t\t\t\t\t...state.sidebars,\n\t\t\t\t\t[id]: { ...sidebar, keyboardShortcut: shortcut },\n\t\t\t\t},\n\t\t\t\tkeyboardShortcuts: newKeyboardShortcuts,\n\t\t\t};\n\t\t});\n\t},\n\n\t// Toggle sidebar by keyboard shortcut\n\ttoggleByShortcut: (shortcut: string, isMobile = false) => {\n\t\tconst sidebarId = sidebarStore.state.keyboardShortcuts[shortcut];\n\t\tif (sidebarId) {\n\t\t\tsidebarActions.toggleSidebar(sidebarId, isMobile);\n\t\t}\n\t},\n\n\t// Clear all persisted sidebar state\n\tclearPersistedState: () => {\n\t\tif (typeof window === \"undefined\") return;\n\t\ttry {\n\t\t\tlocalStorage.removeItem(STORAGE_KEY);\n\t\t\tsidebarStore.setState({ sidebars: {}, keyboardShortcuts: {} });\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to clear sidebar state:\", error);\n\t\t}\n\t},\n\n\t// Clear persisted state for a specific sidebar\n\tclearSidebarState: (id: string) => {\n\t\tsidebarStore.setState((state) => {\n\t\t\tconst { [id]: removedSidebar, ...rest } = state.sidebars;\n\t\t\t\n\t\t\t// Remove keyboard shortcut mapping if exists\n\t\t\tconst newKeyboardShortcuts = { ...state.keyboardShortcuts };\n\t\t\tif (removedSidebar?.keyboardShortcut) {\n\t\t\t\tdelete newKeyboardShortcuts[removedSidebar.keyboardShortcut];\n\t\t\t}\n\n\t\t\treturn { \n\t\t\t\tsidebars: rest,\n\t\t\t\tkeyboardShortcuts: newKeyboardShortcuts,\n\t\t\t};\n\t\t});\n\t},\n};\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/sidebar/sidebar-script.tsx",
      "content": "/**\n * Sidebar initialization script\n * \n * This script MUST be added to your document <head> BEFORE React loads\n * to prevent flash of incorrect sidebar width on page load.\n * \n * Similar to how dark mode detection works - it reads localStorage\n * synchronously and sets CSS variables that the sidebar component uses.\n * \n * Add this to your root layout or HTML template:\n * \n * ```tsx\n * <head>\n *   <SidebarScript />\n *   {/* other head elements *\\/}\n * </head>\n * ```\n */\n\nexport function SidebarScript() {\n\t// This script runs BEFORE React hydration\n\tconst script = `\n\t\t(function() {\n\t\t\ttry {\n\t\t\t\tvar stored = localStorage.getItem('sidebar-state');\n\t\t\t\tif (stored) {\n\t\t\t\t\tvar state = JSON.parse(stored);\n\t\t\t\t\t// Set CSS variables for each sidebar\n\t\t\t\t\tObject.keys(state.sidebars || {}).forEach(function(id) {\n\t\t\t\t\t\tvar sidebar = state.sidebars[id];\n\t\t\t\t\t\tvar width = sidebar.open ? '16rem' : '3.5rem';\n\t\t\t\t\t\tdocument.documentElement.style.setProperty('--sidebar-' + id + '-width', width);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t// Fail silently\n\t\t\t}\n\t\t})();\n\t`;\n\n\treturn (\n\t\t<script\n\t\t\tdangerouslySetInnerHTML={{ __html: script }}\n\t\t\t// Blocking script - runs immediately\n\t\t/>\n\t);\n}\n\n",
      "type": "registry:lib"
    }
  ],
  "categories": [
    "general"
  ]
}